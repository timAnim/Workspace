import{a as k}from"/build/_shared/chunk-UMFVCOIP.js";import{a as d}from"/build/_shared/chunk-CEUMSNV4.js";import{a as F}from"/build/_shared/chunk-3DZTFMOM.js";import{b as i}from"/build/_shared/chunk-GZMK5MKI.js";import{b as y,d as U,i as s}from"/build/_shared/chunk-2ADOHOB6.js";var j=y((L,p)=>{s();p.exports={}});s();s();var l=U(k()),f=U(F()),r=U(j()),S=async({request:c,context:u})=>{var g;let o=await c.formData(),t=await(0,r.getSession)(c.headers.get("cookie")),e=o.get("jsonUrl"),m=o.get("title"),n={};if(e||(n.jsonUrl=!0),Object.keys(n).length)return n;d(typeof e=="string","jsonUrl must be a string");try{let a=await(0,l.createFromUrlOrRawJson)(e,m);if(!a)return(0,r.setErrorMessage)(t,"Unknown error","Could not create document. Please try again."),i("/",{headers:{"Set-Cookie":await(0,r.commitSession)(t)}});let w=new URL(c.url);return u.waitUntil((0,f.sendEvent)({type:"create",from:"urlOrJson",id:a.id,source:(g=w.searchParams.get("utm_source"))!=null?g:w.hostname})),i(`/j/${a.id}`)}catch(a){return a instanceof Error?(0,r.setErrorMessage)(t,a.message,"Something went wrong"):(0,r.setErrorMessage)(t,"Unknown error","Something went wrong"),i("/",{headers:{"Set-Cookie":await(0,r.commitSession)(t)}})}},x=async({request:c,context:u})=>{var n;let o=new URL(c.url),t=o.searchParams.get("jsonUrl");if(!t)return i("/");let e=new URL(t);d(e,"jsonUrl must be a valid URL");let m=await(0,l.createFromUrl)(e,e.href);return u.waitUntil((0,f.sendEvent)({type:"create",from:"url",hostname:e.hostname,id:m.id,source:(n=o.searchParams.get("utm_source"))!=null?n:o.hostname})),i(`/j/${m.id}`)};export{S as action,x as loader};
