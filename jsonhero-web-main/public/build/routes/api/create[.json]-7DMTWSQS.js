import{a as w}from"/build/_shared/chunk-UMFVCOIP.js";import{a as l}from"/build/_shared/chunk-CEUMSNV4.js";import{a as g}from"/build/_shared/chunk-3DZTFMOM.js";import{a as s}from"/build/_shared/chunk-GZMK5MKI.js";import{d as u,i as e}from"/build/_shared/chunk-2ADOHOB6.js";e();e();var d=u(g()),p=u(w()),x=async({request:o})=>{if(o.method==="OPTIONS")return new Response(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST","Access-Control-Allow-Headers":"Content-Type","Access-Control-Max-Age":"86400"}})},J=async({request:o,context:f})=>{let t=new URL(o.url),{title:n,content:r,ttl:i,readOnly:m}=await o.json();if(!n||!r)return s({message:"Missing title or content"},400);l(typeof n=="string","title must be a string"),l(r!==null,"content cannot be null");let A=t.searchParams.get("utm_source"),a={};if(typeof i=="number"){if(i<60)return s({message:"ttl must be at least 60 seconds"},400);a.ttl=i}typeof m=="boolean"&&(a.readOnly=m);let c=await(0,p.createFromRawJson)(n,JSON.stringify(r),a);return t.pathname=`/j/${c.id}`,t.searchParams.delete("utm_source"),f.waitUntil((0,d.sendEvent)({type:"create",from:"url",hostname:t.hostname,id:c.id,source:A})),s({id:c.id,title:n,location:t.toString()},{headers:{"Access-Control-Allow-Origin":"*"}})};export{J as action,x as loader};
